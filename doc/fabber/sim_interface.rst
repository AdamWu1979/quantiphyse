Generating Simulated Fabber Data
================================

.. image:: screenshots/fabber_sim_interface.png

Model selection
---------------

Fabber models are grouped together with other related models. ``Model group`` 
selects the group of models containing the model you want to
simulate. Examples of model groups would be ASL, DSC, CEST etc...

Once a model group has been selected ``Model`` allows you to choose the
actual model you are generating data from. The models are listed using their
internal Fabber names which may not always be clear to an end user. By 
clicking on ``Model options`` a description of the model is displayed
at the top of the options window which may help to clarify the differences
between models.

Model options
-------------

In most cases just selecting a model is not sufficient to generate test
data - at least some configuration options must be given. For example
simulated ASL data will need at least a set of TIs/PLDs and DCE data 
requires a time separation between volumes to be defined. The ``Model Options``
button opens a dialog box to set model options.

.. warn::
    The ``Model Options`` dialog is autogenerated by interrogating Fabber
    for information about the selected model. You may need to be particularly
    careful about units and acceptable values which may be different to those
    used in custom widgets such as the DCE modelling widget.

Model options are normally separated into 'Mandatory' and 'Non-Mandatory'
options, and generally the former are the ones you will need to specify
before you can generate simulated data. However it is not always that 
simple! If you have not configured the model successfully a warning box
is displayed on the simulation widget with a (hopefully!) helpful message
to tell you what needs to be done:

.. image:: screenshots/fabber_sim_options_warning.png

This is a message from a DCE model to indicate that the time separation
parameter needs to be given. 

Test data options
-----------------

The test data is generated 'patchwork' style in which each dimension 
contains the variation in a single parameter. For that reason only three
parameter can be varied at a time. 

 - ``Number of volumes (time points)`` selects the number of volumes in the 
   4D test data set. In some cases this can be set to any value, for examples
   in a DCE model this will just extend the time length of the simulated 
   signal. In some cases, however, the number of volumes may be fixed by
   the model configuration, for example the CEST model requires a list of
   frequencies which defines how many time points you need. In this case
   you must select the correct number of volumes or an error will result.

 - ``Number of voxels per patch (approx)`` chooses how many instances of
   each combination of model parameters are generated. In the absence of
   noise all of these instances will be identical, however with noise added
   the result will be a set of different signals each of which should
   correspond to the same set of parameters. This allows the fitted
   parameters to be averaged over the noisy data.

 - ``Noise`` selects the level of noise as the standard deviation of a
   Gaussian with mean 0 which will be added to the generated data. The
   appropriate value to choose will vary considerably depending on the
   strength of the signal generated by the model so some trial and 
   error may be required in generating noisy data.

 - ``Output data name`` is the name of the output data set

 - ``Output noise-free data`` is useful when generating noisy data. It
   adds a data set with the suffix ``_clean`` containing the simulated
   signal before the addition of noise.

 - ``Output parameter ROIs`` outputs ROI data sets for each varying
   parameter so that averages can easily be displayed in the Data
   Statistics widget over all parts of the output which have the
   same value of a parameter.

Parameter values
----------------

When the model has been successfully configured, the parameters it contains
will be displayed in this section. You can give values to the parameters
of which multiple values can be provided for up to three parameters.
